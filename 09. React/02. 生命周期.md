

constructor
getDerivedStateFromProps
render
componentDidMount

getDerivedStateFromProps
shouldComponentUpdate
render
getSnapshotBeforeProps
componentDidUpdate

componentWillUnmount

# Reactç”Ÿå‘½å‘¨æœŸ

ä¸‰ä¸ªé˜¶æ®µï¼šæŒ‚è½½ï¼Œæ¸²æŸ“ï¼Œå¸è½½



## åºŸå¼ƒçš„ç”Ÿå‘½å‘¨æœŸ

ReactèŠ±äº†ä¸¤å¹´æ—¶é—´ç¥­å‡ºFiberæ¸²æŸ“æœºåˆ¶ã€‚

ç®€å•æ¥è¯´ï¼ŒReactå°†diffçš„è¿‡ç¨‹å«åšReconciliationã€‚ä»¥å‰è¿™ä¸€è¿‡ç¨‹æ˜¯ä¸€æ°”å‘µæˆçš„ï¼ŒFiberæœºåˆ¶æŠŠå®ƒæ”¹æˆäº†å¼‚æ­¥ã€‚å¼‚æ­¥æŠ€èƒ½å°†åœ¨æ¥ä¸‹æ¥çš„ç‰ˆæœ¬ä¸­é€æ­¥è§£é”ã€‚

æ˜æ˜æ˜¯ä¸€æ®µåŒæ­¥ä»£ç ï¼Œæ€ä¹ˆå°±å¼‚æ­¥äº†å‘¢ï¼Ÿ

åŸç†æ˜¯FiberæŠŠä»»åŠ¡åˆ‡æˆå¾ˆå°çš„ç‰‡ï¼Œæ¯æ‰§è¡Œä¸€ç‰‡å°±æŠŠæ§åˆ¶æƒäº¤è¿˜ç»™ä¸»çº¿ç¨‹ï¼Œå¾…ä¸»çº¿ç¨‹å¿™å®Œæ‰‹å¤´çš„æ´»å†æ¥æ‰§è¡Œå‰©ä¸‹çš„ä»»åŠ¡ã€‚å½“ç„¶å¦‚æœæŸä¸€ç‰‡çš„æ‰§è¡Œæ—¶é—´å°±å¾ˆé•¿(æ¯”å¦‚æ­»å¾ªç¯)ï¼Œé‚£å°±æ²¡ä¸»çº¿ç¨‹ä»€ä¹ˆäº‹äº†ï¼Œè¯¥å´©æºƒå´©æºƒã€‚

è¿™ä¼šç»™ç”Ÿå‘½å‘¨æœŸå¸¦æ¥ä»€ä¹ˆå½±å“å‘¢ï¼Ÿ

å½±å“å°±æ˜¯æŒ‚è½½å’Œæ›´æ–°ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸéƒ½å˜çš„ä¸å¯é äº†ã€‚

ä¸ºä»€ä¹ˆè¿™ä¹ˆè®²ï¼Ÿå› ä¸ºReconciliationè¿™ä¸ªè¿‡ç¨‹æœ‰å¯èƒ½æš‚åœç„¶åç»§ç»­æ‰§è¡Œï¼Œæ‰€ä»¥æŒ‚è½½å’Œæ›´æ–°ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­å°±æœ‰å¯èƒ½ä¸æ‰§è¡Œæˆ–è€…å¤šæ¬¡æ‰§è¡Œï¼Œå®ƒçš„è¡¨ç°æ˜¯ä¸å¯é¢„æœŸçš„ã€‚

å› æ­¤16ä¹‹åçš„Reactç”Ÿå‘½å‘¨æœŸè¿æ¥äº†ä¸€æ³¢å¤§æ¢è¡€ï¼Œä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸé’©å­å°†è¢«é€æ¸åºŸå¼ƒï¼š

- componentWillMount
- componentWillReceiveProps
- componentWillUpdate

çœ‹å‡ºç‰¹ç‚¹äº†ä¹ˆï¼Œéƒ½æ˜¯å¸¦æœ‰`will`çš„é’©å­ã€‚

ç›®å‰Reactä¸ºè¿™å‡ ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­æä¾›äº†åˆ«åï¼Œåˆ†åˆ«æ˜¯ï¼š

- UNSAFE_componentWillMount
- UNSAFE_componentWillReceiveProps
- UNSAFE_componentWillUpdate

React17å°†åªæä¾›åˆ«åï¼Œå½»åº•åºŸå¼ƒè¿™ä¸‰ä¸ªå¤§æ´»å®ã€‚å–è¿™ä¹ˆä¸ªåˆ«åæ„æ€å°±æ˜¯è®©ä½ ç”¨ç€æ¶å¿ƒã€‚

### componentWillMount()

> ğŸ’€è¿™æ˜¯Reactä¸å†æ¨èä½¿ç”¨çš„APIã€‚

è¿™æ˜¯ç»„ä»¶æŒ‚è½½åˆ°DOMä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

å¾ˆå¤šäººä¼šæœ‰ä¸€ä¸ªè¯¯åŒºï¼šè¿™ä¸ªé’©å­æ˜¯è¯·æ±‚æ•°æ®ç„¶åå°†æ•°æ®æ’å…¥å…ƒç´ ä¸€åŒæŒ‚è½½çš„æœ€ä½³æ—¶æœºã€‚

å…¶å®`componentWillMount`å’ŒæŒ‚è½½æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ„å‘³ç€æ‰§è¡Œå®Œè¿™ä¸ªé’©å­ï¼Œç«‹å³æŒ‚è½½ã€‚è€Œå‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚æ‰€ä»¥æ— è®ºè¯·æ±‚æ€ä¹ˆå¿«ï¼Œéƒ½è¦æ’åœ¨åŒæ­¥ä»»åŠ¡ä¹‹åå†å¤„ç†ï¼Œè¿™æ˜¯è¾ˆåˆ†é—®é¢˜ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæ°¸è¿œä¸å¯èƒ½åœ¨è¿™é‡Œå°†æ•°æ®æ’å…¥å…ƒç´ ä¸€åŒæŒ‚è½½ã€‚

å¹¶ä¸æ˜¯è¯´ä¸èƒ½åœ¨è¿™é‡Œè¯·æ±‚æ•°æ®ï¼Œè€Œæ˜¯è¾¾ä¸åˆ°ä½ è‡†æƒ³çš„æ•ˆæœã€‚

å®ƒè¢«åºŸå¼ƒçš„åŸå› ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š

- æœ¬æ¥å®ƒå°±æ²¡ä»€ä¹ˆç”¨ã€‚ä¼°è®¡å½“åˆæ˜¯ä¸ºäº†æˆåŒæˆå¯¹æ‰€ä»¥æ‰åˆ›é€ äº†å®ƒå§ã€‚
- å¦‚æœå®ƒå£°æ˜äº†å®šæ—¶å™¨æˆ–è€…è®¢é˜…å™¨ï¼Œåœ¨æœåŠ¡ç«¯æ¸²æŸ“ä¸­ï¼Œ`componentWillUnmount`ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„æ¸…é™¤ä»£ç ä¸ä¼šç”Ÿæ•ˆã€‚å› ä¸ºå¦‚æœç»„ä»¶æ²¡æœ‰æŒ‚è½½æˆåŠŸï¼Œ`componentWillUnmount`æ˜¯ä¸ä¼šæ‰§è¡Œçš„ã€‚å§šæ˜è¯´çš„ï¼šæ²¡æœ‰æŒ‚è½½å°±æ²¡æœ‰å¸è½½ã€‚
- åœ¨å¼‚æ­¥æ¸²æŸ“ä¸­ï¼Œå®ƒçš„è¡¨ç°ä¸ç¨³å®šã€‚

åˆå§‹åŒ–`this.state`åº”è¯¥åœ¨`constructor`ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å®Œæˆï¼Œè¯·æ±‚æ•°æ®åº”è¯¥åœ¨`componentDidMount`ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­å®Œæˆï¼Œæ‰€ä»¥å®ƒä¸ä»…è¢«åºŸå¼ƒäº†ï¼Œè¿ç»§ä»»è€…éƒ½æ²¡æœ‰ã€‚



### componentWillReceiveProps(nextProps)

> ğŸ’€è¿™æ˜¯Reactä¸å†æ¨èä½¿ç”¨çš„APIã€‚

`componentWillReceiveProps`ç”Ÿå‘½å‘¨æœŸé’©å­åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ›´æ–°åçš„propsã€‚

è¯¥å£°æ˜å‘¨æœŸå‡½æ•°å¯èƒ½åœ¨ä¸¤ç§æƒ…å†µä¸‹è¢«è§¦å‘ï¼š

- ç»„ä»¶æ¥æ”¶åˆ°äº†æ–°çš„å±æ€§ã€‚
- ç»„ä»¶æ²¡æœ‰æ”¶åˆ°æ–°çš„å±æ€§ï¼Œä½†æ˜¯ç”±äºçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“å¯¼è‡´å½“å‰ç»„ä»¶ä¹Ÿè¢«é‡æ–°æ¸²æŸ“ã€‚

åˆå§‹åŒ–æ—¶å¹¶ä¸ä¼šè§¦å‘è¯¥ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

åŒæ ·ï¼Œå› ä¸ºFiberæœºåˆ¶çš„å¼•å…¥ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å¯èƒ½ä¼šå¤šæ¬¡è§¦å‘ã€‚

### componentWillUpdate(nextProps, nextState)

> ğŸ’€è¿™æ˜¯Reactä¸å†æ¨èä½¿ç”¨çš„APIã€‚

`shouldComponentUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­è¿”å›trueï¼Œæˆ–è€…è°ƒç”¨`this.forceUpdate`ä¹‹åï¼Œä¼šç«‹å³æ‰§è¡Œè¯¥ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚

è¦ç‰¹åˆ«æ³¨æ„ï¼Œ`componentWillUpdate`ç”Ÿå‘½å‘¨æœŸé’©å­æ¯æ¬¡æ›´æ–°å‰éƒ½ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè°ƒç”¨`this.setState`éå¸¸å±é™©ï¼Œæœ‰å¯èƒ½ä¼šæ²¡å®Œæ²¡äº†ã€‚

åŒæ ·ï¼Œå› ä¸ºFiberæœºåˆ¶çš„å¼•å…¥ï¼Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­æœ‰å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨ã€‚














## æŒ‚è½½è¿‡ç¨‹

- constructor()         æ‰§è¡Œä¸€æ¬¡
- static getDerivedStateFromProps()
- render()
- componentDidMount()    æ‰§è¡Œä¸€æ¬¡









## ç”Ÿå‘½å‘¨æœŸ

### constructor()

ç»„ä»¶æŒ‚è½½ä¹‹å‰ï¼ˆç¬¬ä¸€æ¬¡æ‰§è¡Œrenderï¼‰ï¼Œæ‰§è¡Œæ„é€ å‡½æ•°ã€‚

ç”¨æ¥åˆå§‹åŒ–stateæˆ–è€…ç»‘å®šæ–¹æ³•ã€‚

åœ¨å®ç°å­ç±»çš„æ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å‰é¢åŠ ä¸Šsuper(porops)ï¼Œå¦åˆ™this.propsåœ¨æ„é€ å‡½æ•°ä¸­å¯èƒ½ä¼šæŠ¥é”™ï¼šæœªå®šä¹‰



### static getDerivedStateFromProps()

åœ¨renderå‰ï¼ŒåŠåç»­æ›´æ–°æ—¶éƒ½ä¼šè¢«è°ƒç”¨ã€‚

ç”¨æ³•ï¼šè¿”å›ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–°stateï¼Œå¦‚æœè¿”å›nullè¡¨ç¤ºä¸æ›´æ–°ä»»ä½•å†…å®¹

```js
static getDerivedStateFromProps(props, state) {}
```



### render()

renderä¸ºçº¯å‡½æ•°ï¼Œå³ï¼šåœ¨ä¸ä¿®æ”¹stateå’Œpropsçš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡éƒ½ä¼šè¿”å›ç›¸åŒçš„ç»“æœã€‚

å½“stateæˆ–è€…propså‘ç”Ÿæ”¹å˜æ—¶å€™ï¼Œä¼šè§¦å‘renderã€‚



### componentDidmount()

åœ¨ç»„ä»¶æŒ‚è½½åç«‹å³æ‰§è¡Œã€‚ä¾èµ–domèŠ‚ç‚¹çš„åˆå§‹åŒ–ï¼Œå¦‚å¯¹domçš„æ“ä½œï¼Œæˆ–è€…è¯·æ±‚æ•°æ®éœ€è¦æ¸²æŸ“çš„ï¼Œéƒ½å¯ä»¥æ”¾åˆ°è¿™é‡Œã€‚



### shouldConponentUpdate()

å½“propså’Œstateæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘è¯¥å‡½æ•°ï¼ˆé¦–æ¬¡æ¸²æŸ“å’ŒforceUpdate()çš„æ—¶å€™ä¸æ‰§è¡Œï¼‰

æ ¹æ®`shouldComponentUpdate()`çš„è¿”å›å€¼ï¼Œåˆ¤æ–­reactç»„ä»¶çš„è¾“å‡ºæ˜¯å¦æ”¶åˆ°å½“å‰stateå’Œpropsçš„å½±å“ã€‚

>æ­¤æ–¹æ³•ä»…ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ–¹å¼è€Œå­˜åœ¨ï¼Œä¸è¦ä¼å›¾ä¾é æ­¤æ–¹æ³•æ¥é˜»æ­¢æ¸²æŸ“ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šäº§ç”Ÿ`bug`ï¼Œä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨å†…ç½®çš„`PureComponent`ç»„ä»¶ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨ç¼–å†™`shouldComponentUpdate()`ï¼Œ`PureComponent`ä¼šå¯¹`props`å’Œ`state`è¿›è¡Œæµ…å±‚æ¯”è¾ƒï¼Œå¹¶å‡å°‘äº†è·³è¿‡å¿…è¦æ›´æ–°çš„å¯èƒ½æ€§ã€‚
>å¦‚æœä½ ä¸€å®šè¦æ‰‹åŠ¨ç¼–å†™æ­¤å‡½æ•°ï¼Œå¯ä»¥å°†`this.props`ä¸`nextProps`ä»¥åŠ`this.state`ä¸`nextState`è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶è¿”å›`false`ä»¥å‘ŠçŸ¥`React`å¯ä»¥è·³è¿‡æ›´æ–°ã€‚è¯·æ³¨æ„ï¼Œè¿”å›`false`å¹¶ä¸ä¼šé˜»æ­¢å­ç»„ä»¶åœ¨`state`æ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ã€‚ä¸å»ºè®®åœ¨`shouldComponentUpdate()`ä¸­è¿›è¡Œæ·±å±‚æ¯”è¾ƒæˆ–ä½¿ç”¨`JSON.stringify()`ï¼Œè¿™æ ·éå¸¸å½±å“æ•ˆç‡ï¼Œä¸”ä¼šæŸå®³æ€§èƒ½ã€‚ç›®å‰å¦‚æœ`shouldComponentUpdate()`è¿”å›`false`ï¼Œåˆ™ä¸ä¼šè°ƒç”¨`UNSAFE_componentWillUpdate()`ï¼Œ`render()`å’Œ`componentDidUpdate()`ã€‚åç»­ç‰ˆæœ¬`React`å¯èƒ½ä¼šå°†`shouldComponentUpdate`è§†ä¸ºæç¤ºè€Œä¸æ˜¯ä¸¥æ ¼çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å½“è¿”å›`false`æ—¶ä»å¯èƒ½å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚



### getSnapshotBeforeUpdate()

`getSnapshotBeforeUpdate()`åœ¨æœ€è¿‘ä¸€æ¬¡æ¸²æŸ“è¾“å‡º(æäº¤åˆ°`DOM`èŠ‚ç‚¹)ä¹‹å‰è°ƒç”¨ï¼Œå®ƒä½¿å¾—ç»„ä»¶èƒ½åœ¨å‘ç”Ÿæ›´æ”¹ä¹‹å‰ä»`DOM`ä¸­æ•è·ä¸€äº›ä¿¡æ¯(ä¾‹å¦‚æ»šåŠ¨ä½ç½®)ï¼Œæ­¤ç”Ÿå‘½å‘¨æœŸçš„ä»»ä½•è¿”å›å€¼å°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™`componentDidUpdate()`ï¼Œè¯¥æ–¹æ³•åº”è¿”å›`snapshot`çš„å€¼æˆ–`null`ã€‚
æ­¤ç”¨æ³•å¹¶ä¸å¸¸è§ï¼Œä½†å®ƒå¯èƒ½å‡ºç°åœ¨`UI`å¤„ç†ä¸­ï¼Œå¦‚éœ€è¦ä»¥ç‰¹æ®Šæ–¹å¼å¤„ç†æ»šåŠ¨ä½ç½®çš„èŠå¤©çº¿ç¨‹ç­‰ã€‚





### componentDidUpdate()

`componentDidUpdate()`ä¼šåœ¨æ›´æ–°åä¼šè¢«ç«‹å³è°ƒç”¨ï¼ˆé¦–æ¬¡æ¸²æŸ“ä¸ä¼šæ‰§è¡Œæ­¤æ–¹æ³•ï¼‰

å¦‚æœ`shouldComponentUpdate()`è¿”å›å€¼ä¸º`false`ï¼Œåˆ™ä¸ä¼šè°ƒç”¨`componentDidUpdate()`ã€‚
ä½ ä¹Ÿå¯ä»¥åœ¨`componentDidUpdate()`ä¸­ç›´æ¥è°ƒç”¨`setState()`ï¼Œä½†è¯·æ³¨æ„å®ƒå¿…é¡»è¢«åŒ…è£¹åœ¨ä¸€ä¸ªæ¡ä»¶è¯­å¥é‡Œï¼Œå¦åˆ™ä¼šå¯¼è‡´æ­»å¾ªç¯ï¼Œå› ä¸ºä»–å°†æ— é™æ¬¡è§¦å‘`componentDidUpdate()`ã€‚

å¦‚æœç»„ä»¶å®ç°äº†`getSnapshotBeforeUpdate()`ç”Ÿå‘½å‘¨æœŸ(ä¸å¸¸ç”¨)ï¼Œåˆ™å®ƒçš„è¿”å›å€¼å°†ä½œä¸º`componentDidUpdate()`çš„ç¬¬ä¸‰ä¸ªå‚æ•°`snapshot`å‚æ•°ä¼ é€’ï¼Œå¦åˆ™æ­¤å‚æ•°å°†ä¸º`undefined`ã€‚



### componentWillUnmount()

`componentWillUnmount()`ä¼šåœ¨ç»„ä»¶å¸è½½åŠé”€æ¯ä¹‹å‰ç›´æ¥è°ƒç”¨ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­æ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œï¼Œä¾‹å¦‚æ¸…é™¤`timer`ã€å–æ¶ˆç½‘ç»œè¯·æ±‚æˆ–æ¸…é™¤åœ¨`componentDidMount()`ä¸­åˆ›å»ºçš„è®¢é˜…ç­‰ã€‚





### static getDerivedStateFromError()

æ­¤ç”Ÿå‘½å‘¨æœŸä¼šåœ¨åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯åè¢«è°ƒç”¨ï¼Œå®ƒå°†æŠ›å‡ºçš„é”™è¯¯ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ä»¥æ›´æ–°`state`ã€‚`getDerivedStateFromError()`ä¼šåœ¨æ¸²æŸ“é˜¶æ®µè°ƒç”¨ï¼Œå› æ­¤ä¸å…è®¸å‡ºç°å‰¯ä½œç”¨ï¼Œå¦‚é‡æ­¤ç±»æƒ…å†µï¼Œè¯·æ”¹ç”¨`componentDidCatch()`ã€‚

```
static getDerivedStateFromError(error) {}
```

### componentDidCatch()

æ­¤ç”Ÿå‘½å‘¨æœŸåœ¨åä»£ç»„ä»¶æŠ›å‡ºé”™è¯¯åè¢«è°ƒç”¨ï¼Œ`componentDidCatch()`ä¼šåœ¨æäº¤é˜¶æ®µè¢«è°ƒç”¨ï¼Œå› æ­¤å…è®¸æ‰§è¡Œå‰¯ä½œç”¨ï¼Œå®ƒåº”è¯¥ç”¨äºè®°å½•é”™è¯¯ä¹‹ç±»çš„æƒ…å†µå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

- `error`: æŠ›å‡ºçš„é”™è¯¯ã€‚
- `info`: å¸¦æœ‰`componentStack key`çš„å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³ç»„ä»¶å¼•å‘é”™è¯¯çš„æ ˆä¿¡æ¯ã€‚

```
componentDidCatch(error, info) {}
```











## 2. ç”Ÿå‘½å‘¨æœŸ

åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼ŒReact å®˜æ–¹å¯¹ç”Ÿå‘½å‘¨æœŸæœ‰äº†æ–°çš„ **å˜åŠ¨å»ºè®®**:

- ä½¿ç”¨`getDerivedStateFromProps` æ›¿æ¢ `componentWillMount` ä¸ `componentWillReceiveProps`ï¼›
- ä½¿ç”¨`getSnapshotBeforeUpdate`æ›¿æ¢`componentWillUpdate`ï¼›
- é¿å…ä½¿ç”¨`componentWillReceiveProps`ï¼›

å…¶å®è¯¥å˜åŠ¨çš„åŸå› ï¼Œæ­£æ˜¯ç”±äºä¸Šè¿°æåˆ°çš„ Fiberã€‚é¦–å…ˆï¼Œä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“ React å¯ä»¥åˆ†æˆ reconciliation ä¸ commit ä¸¤ä¸ªé˜¶æ®µï¼Œå¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹:

- **reconciliation**:
  - `componentWillMount`
  - `componentWillReceiveProps`
  - `shouldComponentUpdate`
  - `componentWillUpdate`
- **commit**:
  - `componentDidMount`
  - `componentDidUpdate`
  - `componentWillUnmount`

åœ¨ Fiber ä¸­ï¼Œreconciliation é˜¶æ®µè¿›è¡Œäº†ä»»åŠ¡åˆ†å‰²ï¼Œæ¶‰åŠåˆ° æš‚åœ å’Œ é‡å¯ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´ reconciliation ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°åœ¨ä¸€æ¬¡æ›´æ–°æ¸²æŸ“å¾ªç¯ä¸­è¢« **å¤šæ¬¡è°ƒç”¨** çš„æƒ…å†µï¼Œäº§ç”Ÿä¸€äº›æ„å¤–é”™è¯¯ã€‚

æ–°ç‰ˆçš„å»ºè®®ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹:

```js
class Component extends React.Component {
  // æ›¿æ¢ `componentWillReceiveProps` ï¼Œ
  // åˆå§‹åŒ–å’Œ update æ—¶è¢«è°ƒç”¨
  // é™æ€å‡½æ•°ï¼Œæ— æ³•ä½¿ç”¨ this
  static getDerivedStateFromProps(nextProps, prevState) {}
  
  // åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ç»„ä»¶
  // å¯ä»¥ç”¨äºç»„ä»¶æ€§èƒ½ä¼˜åŒ–
  shouldComponentUpdate(nextProps, nextState) {}
  
  // ç»„ä»¶è¢«æŒ‚è½½åè§¦å‘
  componentDidMount() {}
  
  // æ›¿æ¢ componentWillUpdate
  // å¯ä»¥åœ¨æ›´æ–°ä¹‹å‰è·å–æœ€æ–° dom æ•°æ®
  getSnapshotBeforeUpdate() {}
  
  // ç»„ä»¶æ›´æ–°åè°ƒç”¨
  componentDidUpdate() {}
  
  // ç»„ä»¶å³å°†é”€æ¯
  componentWillUnmount() {}
  
  // ç»„ä»¶å·²é”€æ¯
  componentDidUnmount() {}
}
å¤åˆ¶ä»£ç 
```

- **ä½¿ç”¨å»ºè®®**:

  - åœ¨`constructor`åˆå§‹åŒ– stateï¼›

  - åœ¨`componentDidMount`ä¸­è¿›è¡Œäº‹ä»¶ç›‘å¬ï¼Œå¹¶åœ¨`componentWillUnmount`ä¸­è§£ç»‘äº‹ä»¶ï¼›

  - åœ¨`componentDidMount`ä¸­è¿›è¡Œæ•°æ®çš„è¯·æ±‚ï¼Œè€Œä¸æ˜¯åœ¨`componentWillMount`ï¼›

  - éœ€è¦æ ¹æ® props æ›´æ–° state æ—¶ï¼Œä½¿ç”¨

    ```js
    getDerivedStateFromProps(nextProps, prevState)
    ```

    ï¼›

    - æ—§ props éœ€è¦è‡ªå·±å­˜å‚¨ï¼Œä»¥ä¾¿æ¯”è¾ƒï¼›

  ```js
  public static getDerivedStateFromProps(nextProps, prevState) {
  	// å½“æ–° props ä¸­çš„ data å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒåŒæ­¥æ›´æ–°åˆ° state ä¸Š
  	if (nextProps.data !== prevState.data) {
  		return {
  			data: nextProps.data
  		}
  	} else {
  		return null1
  	}
  }
  å¤åˆ¶ä»£ç 
  ```

  - å¯ä»¥åœ¨`componentDidUpdate`ç›‘å¬ props æˆ–è€… state çš„å˜åŒ–ï¼Œä¾‹å¦‚:

  ```js
  componentDidUpdate(prevProps) {
  	// å½“ id å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°è·å–æ•°æ®
  	if (this.props.id !== prevProps.id) {
  		this.fetchData(this.props.id);
  	}
  }
  å¤åˆ¶ä»£ç 
  ```

  - åœ¨`componentDidUpdate`ä½¿ç”¨`setState`æ—¶ï¼Œå¿…é¡»åŠ æ¡ä»¶ï¼Œå¦åˆ™å°†è¿›å…¥æ­»å¾ªç¯ï¼›
  - `getSnapshotBeforeUpdate(prevProps, prevState)`å¯ä»¥åœ¨æ›´æ–°ä¹‹å‰è·å–æœ€æ–°çš„æ¸²æŸ“æ•°æ®ï¼Œå®ƒçš„è°ƒç”¨æ˜¯åœ¨ render ä¹‹åï¼Œ update ä¹‹å‰ï¼›
  - `shouldComponentUpdate`: é»˜è®¤æ¯æ¬¡è°ƒç”¨`setState`ï¼Œä¸€å®šä¼šæœ€ç»ˆèµ°åˆ° diff é˜¶æ®µï¼Œä½†å¯ä»¥é€šè¿‡`shouldComponentUpdate`çš„ç”Ÿå‘½é’©å­è¿”å›`false`æ¥ç›´æ¥é˜»æ­¢åé¢çš„é€»è¾‘æ‰§è¡Œï¼Œé€šå¸¸æ˜¯ç”¨äºåšæ¡ä»¶æ¸²æŸ“ï¼Œä¼˜åŒ–æ¸²æŸ“çš„æ€§èƒ½ã€‚









